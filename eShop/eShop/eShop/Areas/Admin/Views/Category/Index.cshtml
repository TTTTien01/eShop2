@using eShop.Areas.Admin.ViewModels.Category

@model IEnumerable<ListItemCategoryVM>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>


<div id="vueData">
    <p>
        <button class="btn btn-success" v-on:click="showCreateModal()">Create new</button>
        <button class="btn btn-primary" v-on:click="refreshData()">Làm mới dữ liệu</button>
    </p>


    <table class="table">
        <thead>
            <tr>
                <th> Id</th>
                <th>Tên danh mục</th>
                <th>Ngày tạo</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="item in categories">
                <td>{{item.id}} </td>
                <td>{{item.name}}</td>
                <td>{{ new Date((item.createAt)).toLocaleString('en-GB') }} </td>
                <td>
                    <a class="btn btn-success" v-bind:href="'/Admin/Category/Edit/' + item.id">Edit</a> |
                    <button class="btn btn-danger" v-on:click="deleteCategory(item.id)">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>
    <partial name="_Create"/>
</div>


@section Scripts{
    <script>

        let noti = new AWN(); //sd awesome-notifications
        let modalCreate = new bootstrap.Modal("#modalCreate");

        Vue.createApp({
            data(){
                return {
                    categories: [],
                    cateData:{
                        id:null,
                        name:null
                    }
                };
            },
            methods: {
                showCreateModal(){
                    modalCreate.show();
                },

                deleteCategory(id){
                    console.log(id);
                    noti.confirm(
                     "Xác nhận xóa dữ liệu?",
                      () => {
                          noti.async(
                              axios.get("/Admin/Category/Delete/" + id),
                              (response) => {
                                  var data = response.data;
                                  if(data.success){
                                        noti.success("Xóa thành công! ");
                                        //Load du lieu trang index
                                        this.refreshData();
                                  }else{
                                      noti.warning(data.msg);
                                  }

                              },
                          );
                      }
                    );
                },
                refreshData(){
                    noti.asyncBlock(
                        //gọi ajax thông qua thư viện axios
                        axios.get("/Admin/Category/GetAll")
                        ,
                        //khi xử lý
                        (response) => {
                            console.log(response.data);
                            this.categories = response.data; //gán sd đc nhận vào data
                            noti.success("Tải thành công")
                        }
                        ,
                        //Thất bại
                        (err) => {
                            console.log(err);
                            noti.alert("Tải dữ liệu thất bại")
                        }
                        ,
                        //nội dung chờ
                        "Chờ xíu"
                    )
                }

            },
            mounted() {
                this.refreshData();
            }
        }).mount("#vueData")
    </script>
}

